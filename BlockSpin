local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "Zeta Combat Hub",
    Icon = "sword",
    Author = "by Alpha",
    Folder = "ZetaHub", 
    Theme = "Dark"
})

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Send = ReplicatedStorage.Remotes.Send

-- Aimbot Variables
local CurrentShootToken = 545
local TargetPlayer = nil
local AimbotEnabled = false

-- ESP Variables
local ESPEnabled = false
local BoxESPEnabled = false
local PlayerInfoEnabled = false
local ESPData = {}

-- Drawing Objects
local FOVCircle = Drawing.new("Circle")
local TracerLine = Drawing.new("Line")
local TargetNameText = Drawing.new("Text")

-- Setup FOV Circle
FOVCircle.Visible = false
FOVCircle.Radius = 100
FOVCircle.Color = Color3.new(1, 0, 0)
FOVCircle.Thickness = 2
FOVCircle.Transparency = 0.3
FOVCircle.Filled = false

-- Setup Tracer Line
TracerLine.Visible = false  
TracerLine.Color = Color3.new(1, 0, 0)
TracerLine.Thickness = 2

-- Setup Target Name Text
TargetNameText.Visible = false
TargetNameText.Color = Color3.new(1, 1, 1)
TargetNameText.Size = 18
TargetNameText.Center = true
TargetNameText.Outline = true
TargetNameText.Font = 2

-- ==================== AIMBOT SYSTEM ====================

-- ระบบตรวจจับปืนอัตโนมัติ
local function detectWeapon()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    for _, tool in ipairs(character:GetChildren()) do
        if tool:IsA("Tool") then
            return tool
        end
    end
    return nil
end

-- หาเป้าหมายเดียวใน FOV
local function findTargetInFOV()
    local closest = nil
    local closestDistance = FOVCircle.Radius
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            local head = player.Character:FindFirstChild("Head")
            
            if humanoid and humanoid.Health > 0 and head then
                local screenPoint, visible = Camera:WorldToViewportPoint(head.Position)
                if visible then
                    local distance = (Vector2.new(screenPoint.X, screenPoint.Y) - center).Magnitude
                    if distance < closestDistance then
                        closest = player
                        closestDistance = distance
                    end
                end
            end
        end
    end
    
    return closest
end

-- ฟังก์ชันยิง
local function manualShoot()
    if not TargetPlayer or not TargetPlayer.Character then 
        print("❌ ไม่มีเป้าหมายที่จะยิง")
        return 
    end
    
    local weapon = detectWeapon()
    local head = TargetPlayer.Character:FindFirstChild("Head")
    
    if weapon and head then
        Send:FireServer(
            CurrentShootToken,
            "shoot_gun",
            weapon,
            weapon.Handle.CFrame,
            {
                {
                    {
                        Instance = head,
                        Normal = Vector3.new(0, 1, 0),
                        Position = head.Position
                    }
                }
            }
        )
        print("🔫 ยิงเป้าหมาย: " .. TargetPlayer.Name)
    else
        print("❌ ไม่พบปืนหรือหัวเป้าหมาย")
    end
end

-- อัพเดท Visuals Aimbot
local function updateAimbotVisuals()
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    
    FOVCircle.Position = center
    FOVCircle.Visible = AimbotEnabled
    
    if TargetPlayer and TargetPlayer.Character then
        local head = TargetPlayer.Character:FindFirstChild("Head")
        if head then
            local screenPoint, visible = Camera:WorldToViewportPoint(head.Position)
            if visible then
                -- Tracer Line
                TracerLine.From = center
                TracerLine.To = Vector2.new(screenPoint.X, screenPoint.Y)
                TracerLine.Visible = AimbotEnabled
                
                -- Target Name Text
                local displayName = "workspace." .. TargetPlayer.Name .. ".Head"
                TargetNameText.Text = displayName
                TargetNameText.Position = Vector2.new(screenPoint.X, screenPoint.Y - 30)
                TargetNameText.Visible = AimbotEnabled
                return
            end
        end
    end
    
    TracerLine.Visible = false
    TargetNameText.Visible = false
end

-- ใช้ปุ่มยิงเดิมของเกม (เมื่อกดยิงปกติ)
local function hookGameShootButton()
    -- เมื่อผู้เล่นกดปุ่มยิงของเกม ให้ตรวจสอบว่ามีเป้าหมายหรือไม่
    local originalFire = Send.FireServer
    Send.FireServer = function(self, ...)
        local args = {...}
        
        -- ถ้าเป็นคำสั่งยิงและมีเป้าหมายล็อคอยู่
        if args[2] == "shoot_gun" and AimbotEnabled and TargetPlayer then
            local weapon = detectWeapon()
            local head = TargetPlayer.Character:FindFirstChild("Head")
            
            if weapon and head then
                -- แทนที่ด้วยการยิงเป้าหมายที่ล็อค
                args[4] = weapon.Handle.CFrame
                args[5] = {
                    {
                        {
                            Instance = head,
                            Normal = Vector3.new(0, 1, 0),
                            Position = head.Position
                        }
                    }
                }
                print("🎯 ยิงเป้าหมายที่ล็อค: " .. TargetPlayer.Name)
            end
        end
        
        return originalFire(self, unpack(args))
    end
end

-- ==================== ESP SYSTEM ====================

-- ฟังก์ชันสร้าง ESP สำหรับผู้เล่น
local function createESP(player)
    if ESPData[player] then return end
    
    ESPData[player] = {
        Box = {
            TopLeft = Drawing.new("Line"),
            TopRight = Drawing.new("Line"),
            BottomLeft = Drawing.new("Line"),
            BottomRight = Drawing.new("Line")
        },
        NameText = Drawing.new("Text"),
        DistanceText = Drawing.new("Text"),
        HealthText = Drawing.new("Text")
    }
    
    local esp = ESPData[player]
    
    -- ตั้งค่ากรอบ Box
    for _, line in pairs(esp.Box) do
        line.Thickness = 2
        line.Color = Color3.new(1, 0, 0)
    end
    
    -- ตั้งค่าข้อความ
    esp.NameText.Size = 14
    esp.NameText.Outline = true
    esp.NameText.Color = Color3.new(1, 1, 1)
    
    esp.DistanceText.Size = 12
    esp.DistanceText.Outline = true
    esp.DistanceText.Color = Color3.new(1, 1, 0)
    
    esp.HealthText.Size = 12
    esp.HealthText.Outline = true
    esp.HealthText.Color = Color3.new(0, 1, 0)
end

-- ฟังก์ชันอัพเดท ESP
local function updateESP(player)
    if not ESPData[player] then return end
    
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local head = character:FindFirstChild("Head")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if not humanoid or humanoid.Health <= 0 or not head or not rootPart then
        for _, line in pairs(ESPData[player].Box) do
            line.Visible = false
        end
        ESPData[player].NameText.Visible = false
        ESPData[player].DistanceText.Visible = false
        ESPData[player].HealthText.Visible = false
        return
    end
    
    local headPos, headVisible = Camera:WorldToViewportPoint(head.Position)
    local rootPos, rootVisible = Camera:WorldToViewportPoint(rootPart.Position)
    
    if headVisible and rootVisible then
        local esp = ESPData[player]
        
        -- คำนวณขนาด Box
        local height = math.abs(headPos.Y - rootPos.Y) * 1.5
        local width = height * 0.6
        
        local topLeft = Vector2.new(headPos.X - width/2, headPos.Y - height/2)
        local topRight = Vector2.new(headPos.X + width/2, headPos.Y - height/2)
        local bottomLeft = Vector2.new(headPos.X - width/2, headPos.Y + height/2)
        local bottomRight = Vector2.new(headPos.X + width/2, headPos.Y + height/2)
        
        -- อัพเดท Box
        if BoxESPEnabled then
            esp.Box.TopLeft.From = topLeft
            esp.Box.TopLeft.To = topRight
            esp.Box.TopLeft.Visible = true
            
            esp.Box.TopRight.From = topRight
            esp.Box.TopRight.To = bottomRight
            esp.Box.TopRight.Visible = true
            
            esp.Box.BottomLeft.From = bottomLeft
            esp.Box.BottomLeft.To = bottomRight
            esp.Box.BottomLeft.Visible = true
            
            esp.Box.BottomRight.From = bottomLeft
            esp.Box.BottomRight.To = topLeft
            esp.Box.BottomRight.Visible = true
        else
            for _, line in pairs(esp.Box) do
                line.Visible = false
            end
        end
        
        -- อัพเดท Player Info
        if PlayerInfoEnabled then
            -- ชื่อผู้เล่น
            esp.NameText.Text = player.Name
            esp.NameText.Position = Vector2.new(headPos.X, headPos.Y - height/2 - 20)
            esp.NameText.Visible = true
            
            -- ระยะทาง
            local distance = (LocalPlayer.Character.Head.Position - head.Position).Magnitude
            esp.DistanceText.Text = string.format("%.1fm", distance)
            esp.DistanceText.Position = Vector2.new(headPos.X, headPos.Y - height/2 - 35)
            esp.DistanceText.Visible = true
            
            -- HP
            esp.HealthText.Text = string.format("HP: %d", math.floor(humanoid.Health))
            esp.HealthText.Position = Vector2.new(headPos.X, headPos.Y - height/2 - 50)
            esp.HealthText.Visible = true
        else
            esp.NameText.Visible = false
            esp.DistanceText.Visible = false
            esp.HealthText.Visible = false
        end
    else
        for _, line in pairs(ESPData[player].Box) do
            line.Visible = false
        end
        ESPData[player].NameText.Visible = false
        ESPData[player].DistanceText.Visible = false
        ESPData[player].HealthText.Visible = false
    end
end

-- ฟังก์ชันลบ ESP
local function removeESP(player)
    if ESPData[player] then
        for _, line in pairs(ESPData[player].Box) do
            line:Remove()
        end
        ESPData[player].NameText:Remove()
        ESPData[player].DistanceText:Remove()
        ESPData[player].HealthText:Remove()
        ESPData[player] = nil
    end
end

-- ==================== UI SETUP ====================

-- Tab Combat
local CombatTab = Window:Tab({
    Title = "Combat",
    Icon = "target"
})

-- Tab ESP
local ESPTab = Window:Tab({
    Title = "ESP",
    Icon = "eye"
})

-- UI Elements ใน Tab Combat
local AimbotToggle = CombatTab:Toggle({
    Title = "Aimbot Lock",
    Default = false,
    Callback = function(value)
        AimbotEnabled = value
        if value then
            hookGameShootButton()
        end
        if not value then
            TargetPlayer = nil
            TracerLine.Visible = false
            TargetNameText.Visible = false
        end
        print("🎯 Aimbot Lock:", value)
    end
})

local FOVSlider = CombatTab:Slider({
    Title = "FOV Size",
    Min = 50,
    Max = 300,
    Default = 100,
    Callback = function(value)
        FOVCircle.Radius = value
    end
})

local ShootInstruction = CombatTab:Label({
    Title = "ใช้ปุ่มยิงเดิมของเกม",
    Callback = function() end
})

-- UI Elements ใน Tab ESP
local ESPToggle = ESPTab:Toggle({
    Title = "ESP Master",
    Default = false,
    Callback = function(value)
        ESPEnabled = value
        if not value then
            BoxESPEnabled = false
            PlayerInfoEnabled = false
            for player, _ in pairs(ESPData) do
                removeESP(player)
            end
        end
        print("👁️ ESP Master:", value)
    end
})

local BoxToggle = ESPTab:Toggle({
    Title = "Box",
    Default = false,
    Callback = function(value)
        BoxESPEnabled = value and ESPEnabled
        print("📦 Box ESP:", BoxESPEnabled)
    end
})

local PlayerInfoToggle = ESPTab:Toggle({
    Title = "Player Info",
    Default = false,
    Callback = function(value)
        PlayerInfoEnabled = value and ESPEnabled
        print("👤 Player Info:", PlayerInfoEnabled)
    end
})

local ESPColorPicker = ESPTab:ColorPicker({
    Title = "Box Color",
    Default = Color3.new(1, 0, 0),
    Callback = function(color)
        for player, esp in pairs(ESPData) do
            for _, line in pairs(esp.Box) do
                line.Color = color
            end
        end
        print("🎨 เปลี่ยนสี Box เป็น:", color)
    end
})

-- ==================== MAIN LOOPS ====================

-- Aimbot Loop
RunService.RenderStepped:Connect(function()
    if AimbotEnabled then
        local newTarget = findTargetInFOV()
        if newTarget ~= TargetPlayer then
            TargetPlayer = newTarget
            if TargetPlayer then
                print("🎯 ล็อคเป้าหมาย: " .. TargetPlayer.Name)
            end
        end
        updateAimbotVisuals()
    else
        FOVCircle.Visible = false
        TracerLine.Visible = false
        TargetNameText.Visible = false
    end
end)

-- ESP Loop
RunService.RenderStepped:Connect(function()
    if ESPEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                if not ESPData[player] then
                    createESP(player)
                end
                updateESP(player)
            end
        end
    else
        for player, _ in pairs(ESPData) do
            removeESP(player)
        end
    end
end)

-- ลบ ESP เมื่อผู้เล่นออก
Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
end)

print("✅ Zeta Ultimate System พร้อมใช้งาน!")
print("🎯 Aimbot + ESP System รวมเป็นหนึ่งเดียว")
print("🎮 ใช้ปุ่มยิงเดิมของเกม - ไม่มีปุ่มเขียว")
